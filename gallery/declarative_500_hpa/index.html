<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>declarative_500_hPa | The Unidata Python Training Site</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://unidata.github.io/python-training/gallery/declarative_500_hpa/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="UCAR/Unidata">
<meta property="og:site_name" content="The Unidata Python Training Site">
<meta property="og:title" content="declarative_500_hPa">
<meta property="og:url" content="https://unidata.github.io/python-training/gallery/declarative_500_hpa/">
<meta property="og:description" content="Declarative 500-hPa Absolute Vorticity¶By: Kevin Goebbert
This example uses the declarative syntax available through the MetPy package to allow a more convenient method for creating simple maps of atm">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-01-08T09:47:29-07:00">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://unidata.github.io/python-training/">

                <span id="blog-title">The Unidata Python Training Site</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../python/intro-to-python">Introduction to Python</a>
                </li>
<li>
<a href="../gallery-home">Example Gallery</a>
                </li>
<li>
<a href="../../workshop/workshop-intro">Python Workshop Materials</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
    <a href="index.ipynb" id="sourcelink">Source</a>
    </li>
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
<article class="post-text storypage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">declarative_500_hPa</a></h1>

        
    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Declarative-500-hPa-Absolute-Vorticity">Declarative 500-hPa Absolute Vorticity<a class="anchor-link" href="#Declarative-500-hPa-Absolute-Vorticity">¶</a>
</h2>
<p>By: Kevin Goebbert</p>
<p>This example uses the declarative syntax available through the MetPy package to allow a more convenient method for creating simple maps of atmospheric data. To plot aboslute vorticity, the data is scaled and reassigned to the xarray object for use in the declarative plotting interface.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">from</span> <span class="nn">metpy.plots</span> <span class="kn">import</span> <span class="n">declarative</span>
<span class="kn">from</span> <span class="nn">metpy.units</span> <span class="kn">import</span> <span class="n">units</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>

<span class="c1"># Set date for desired dataset</span>
<span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>

<span class="c1"># Open dataset from NCEI</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">'https://www.ncei.noaa.gov/thredds/dodsC/'</span>
                     <span class="sa">f</span><span class="s1">'gfs-g4-anl-files/{date:%Y%m}/{date:%Y%m</span><span class="si">%d</span><span class="s1">}/'</span>
                     <span class="sa">f</span><span class="s1">'gfsanl_4_{date:%Y%m</span><span class="si">%d</span><span class="s1">}_{date:%H}00_000.grb2'</span>
                     <span class="p">)</span><span class="o">.</span><span class="n">metpy</span><span class="o">.</span><span class="n">parse_cf</span><span class="p">()</span>

<span class="c1"># Subset Data to be just over CONUS</span>
<span class="n">ds_us</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">360</span><span class="o">-</span><span class="mi">150</span><span class="p">,</span> <span class="mi">360</span><span class="o">-</span><span class="mi">50</span><span class="p">),</span> <span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">65</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Scale-Data">Scale Data<a class="anchor-link" href="#Scale-Data">¶</a>
</h3>
<p>Since absolute vorticity has values much smaller than one, then for plotting contour values with labels it is adventageous to scale values to be whole numbers. This is done by multiplying the variable by <code>1*10^5</code> or <code>1e5</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ds_us</span><span class="p">[</span><span class="s1">'Absolute_vorticity_isobaric'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">Absolute_vorticity_isobaric</span> <span class="o">*</span> <span class="mf">1e5</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Contour-Intervals">Contour Intervals<a class="anchor-link" href="#Contour-Intervals">¶</a>
</h3>
<p>Since absolute vorticity rarely goes below zero in the Northern Hemisphere, we can set up a list of contour levels that doesn't include values near but greater than zero. The following code yields a list containing: <code>[-8, -7, -6, -5, -4, -3, -2, -1, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45]</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Absolute Vorticity colors</span>
<span class="c1"># Use two different colormaps from matplotlib and combine into one color set</span>
<span class="n">clevs_500_avor</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="The-Plot">The Plot<a class="anchor-link" href="#The-Plot">¶</a>
</h3>
<p>Using the declarative interface in MetPy to plot the 500-hPa Geopotential Heights and Absolute Vorticity.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Set Contour Plot Parameters</span>
<span class="n">contour</span> <span class="o">=</span> <span class="n">declarative</span><span class="o">.</span><span class="n">ContourPlot</span><span class="p">()</span>
<span class="n">contour</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">ds_us</span>
<span class="n">contour</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">date</span>
<span class="n">contour</span><span class="o">.</span><span class="n">field</span> <span class="o">=</span> <span class="s1">'Geopotential_height_isobaric'</span>
<span class="n">contour</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="mi">500</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">hPa</span>
<span class="n">contour</span><span class="o">.</span><span class="n">linecolor</span> <span class="o">=</span> <span class="s1">'black'</span>
<span class="n">contour</span><span class="o">.</span><span class="n">linestyle</span> <span class="o">=</span> <span class="s1">'-'</span>
<span class="n">contour</span><span class="o">.</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">contour</span><span class="o">.</span><span class="n">clabels</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">contour</span><span class="o">.</span><span class="n">contours</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>

<span class="c1"># Set Color-filled Contour Parameters</span>
<span class="n">cfill</span> <span class="o">=</span> <span class="n">declarative</span><span class="o">.</span><span class="n">FilledContourPlot</span><span class="p">()</span>
<span class="n">cfill</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">ds_us</span>
<span class="n">cfill</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">date</span>
<span class="n">cfill</span><span class="o">.</span><span class="n">field</span> <span class="o">=</span> <span class="s1">'Absolute_vorticity_isobaric'</span>
<span class="n">cfill</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="mi">500</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">hPa</span>
<span class="n">cfill</span><span class="o">.</span><span class="n">contours</span> <span class="o">=</span> <span class="n">clevs_500_avor</span>
<span class="n">cfill</span><span class="o">.</span><span class="n">colormap</span> <span class="o">=</span> <span class="s1">'PuOr_r'</span>
<span class="n">cfill</span><span class="o">.</span><span class="n">image_range</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">45</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span>
<span class="n">cfill</span><span class="o">.</span><span class="n">colorbar</span> <span class="o">=</span> <span class="s1">'horizontal'</span>

<span class="c1"># Panel for plot with Map features</span>
<span class="n">panel</span> <span class="o">=</span> <span class="n">declarative</span><span class="o">.</span><span class="n">MapPanel</span><span class="p">()</span>
<span class="n">panel</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">panel</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">124</span><span class="p">,</span> <span class="o">-</span><span class="mi">72</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">53</span><span class="p">)</span>
<span class="n">panel</span><span class="o">.</span><span class="n">projection</span> <span class="o">=</span> <span class="s1">'lcc'</span>
<span class="n">panel</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'coastline'</span><span class="p">,</span> <span class="s1">'borders'</span><span class="p">,</span> <span class="s1">'states'</span><span class="p">]</span>
<span class="n">panel</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{cfill.level}</span><span class="s1"> GFS Geopotential Heights'</span>
               <span class="sa">f</span><span class="s1">'and Absolute Vorticity at </span><span class="si">{date}</span><span class="s1">'</span><span class="p">)</span>
<span class="n">panel</span><span class="o">.</span><span class="n">plots</span> <span class="o">=</span> <span class="p">[</span><span class="n">cfill</span><span class="p">,</span> <span class="n">contour</span><span class="p">]</span>

<span class="c1"># Bringing it all together</span>
<span class="n">pc</span> <span class="o">=</span> <span class="n">declarative</span><span class="o">.</span><span class="n">PanelContainer</span><span class="p">()</span>
<span class="n">pc</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
<span class="n">pc</span><span class="o">.</span><span class="n">panels</span> <span class="o">=</span> <span class="p">[</span><span class="n">panel</span><span class="p">]</span>

<span class="n">pc</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
</div>
    </div>
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
    },
    displayAlign: 'center', // Change this to 'left' if you want left-aligned equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2020         <a href="mailto:support-python@ucar.edu">UCAR/Unidata</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>

            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
